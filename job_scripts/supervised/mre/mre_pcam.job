#!/bin/bash

#SBATCH -N 1 # number of nodes
#SBATCH --partition=batch
#SBATCH --job-name=mre_pcam
#SBATCH --gpus-per-node=1
#SBATCH --time=00:15:00
#SBATCH --output=temp_logs/slurm_output_%j.out

LOGS_DIR=/home/b.dolicki/logs
CHECKPOINT_DIR=$LOGS_DIR/supervised/mre/$SLURM_JOB_NAME/$SLURM_JOB_ID

source activate vissl
cd $HOME/thesis/ssl-histo/
mkdir -p $CHECKPOINT_DIR

DATA_DIR="/mnt/archive/projectdata/data_pcam"

python evaluate_mre.py --dataset pcam --data_dir $DATA_DIR --split test --log_dir $CHECKPOINT_DIR \
                --mlflow_dir /home/b.dolicki/thesis/mlflow_runs \
                --checkpoint_path /home/b.dolicki/logs/supervised/pcam/important/12932/checkpoints/model_epoch_45.pt \
                --batch_size=5 --num_workers=1 --exp_name mre_pcam --mre_n 16 --sample 100 --save_samples 5

echo "finished"

# move slurm output from default location to logs after the job is finished
mv $HOME/thesis/rissl/temp_logs/slurm_output_$SLURM_JOB_ID.out $CHECKPOINT_DIR/